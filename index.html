<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #0d1117; color: white; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        /* Баланс */
        .header { width: 100%; padding: 15px; display: flex; justify-content: center; background: #161b22; }
        .balance { background: #21262d; padding: 10px 20px; border-radius: 20px; color: #f0b90b; font-weight: bold; display: flex; align-items: center; gap: 8px; }

        /* Игровое поле */
        .game-view { position: relative; width: 100%; height: 40vh; background: radial-gradient(circle at bottom, #1e293b 0%, #0d1117 80%); display: flex; justify-content: center; align-items: center; overflow: hidden; }
        #multiplier { font-size: 4rem; font-weight: bold; color: #38bdf8; text-shadow: 0 0 20px rgba(56, 189, 248, 0.5); z-index: 10; }
        
        /* Ракета */
        #rocket { 
            position: absolute; width: 120px; height: 120px; 
            background: url('https://raw.githubusercontent.com/syetolog2011-sudo/rocket/main/skeleton.png') no-repeat center; 
            background-size: contain; bottom: 20%; left: 10%; transition: transform 0.1s linear; 
            filter: drop-shadow(0 0 10px #38bdf8); display: none;
        }

        /* Список игроков */
        .players-box { width: 90%; background: #161b22; border-radius: 15px; margin-top: 20px; padding: 10px; flex-grow: 1; overflow-y: auto; }
        .player-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #30363d; font-size: 14px; }

        /* Кнопка */
        .main-button { width: 90%; padding: 18px; border-radius: 15px; border: none; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-bottom: 20px; transition: 0.2s; }
        .bet-mode { background: #388bfd; color: white; }
        .cashout-mode { background: #f0b90b; color: black; }
        .disabled { background: #484f58; color: #8b949e; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="header">
    <div class="balance">⭐️ <span id="user-stars">50</span></div>
</div>

<div class="game-view">
    <div id="multiplier">x1.00</div>
    <div id="rocket"></div>
</div>

<div class="players-box" id="player-list">
    <div style="text-align: center; color: #8b949e; margin-top: 20px;">Ожидание ставок...</div>
</div>

<button id="action-btn" class="main-button bet-mode" onclick="handleBtn()">СДЕЛАТЬ СТАВКУ</button>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();

    let balance = 50;
    let currentMult = 1.00;
    let gameState = "waiting"; // waiting, flying, crashed
    let crashPoint = 0;
    let timer;

    const btn = document.getElementById('action-btn');
    const multDisplay = document.getElementById('multiplier');
    const rocket = document.getElementById('rocket');

    function handleBtn() {
        if (gameState === "waiting") {
            placeBet();
        } else if (gameState === "flying") {
            cashOut();
        }
    }

    function placeBet() {
        if (balance < 10) return alert("Недостаточно звезд!");
        balance -= 10;
        document.getElementById('user-stars').innerText = balance;
        
        btn.innerText = "ОЖИДАНИЕ ВЗЛЕТА...";
        btn.className = "main-button disabled";
        gameState = "ready";
        
        // Через 3 секунды взлет
        setTimeout(startFlight, 2000);
    }

    function startFlight() {
        gameState = "flying";
        btn.innerText = `ЗАБРАТЬ ${(10 * currentMult).toFixed(0)} ⭐️`;
        btn.className = "main-button cashout-mode";
        rocket.style.display = "block";
        
        crashPoint = (Math.random() * 3 + 1.1); // Рандом от 1.1 до 4.1
        if (Math.random() < 0.05) crashPoint = 10 + Math.random() * 50; // 5% шанс на большой икс

        timer = setInterval(() => {
            currentMult += 0.01; // СКОРОСТЬ РОСТА (0.01 - плавно)
            multDisplay.innerText = "x" + currentMult.toFixed(2);
            
            // Анимация ракеты (плавное движение)
            let xProgress = (currentMult - 1) * 20;
            let yProgress = Math.sin(currentMult * 2) * 10;
            rocket.style.transform = `translate(${xProgress}px, ${yProgress}px)`;

            if (gameState === "flying") {
                btn.innerText = `ЗАБРАТЬ ${(10 * currentMult).toFixed(1)} ⭐️`;
            }

            if (currentMult >= crashPoint) {
                crash();
            }
        }, 80); // Интервал обновления (80мс - комфортно для глаз)
    }

    function cashOut() {
        if (gameState !== "flying") return;
        let win = (10 * currentMult).toFixed(1);
        balance += parseFloat(win);
        document.getElementById('user-stars').innerText = balance.toFixed(1);
        
        alert("Вы забрали " + win + " звезд!");
        gameState = "cashed_out";
        btn.innerText = "ОЖИДАНИЕ...";
        btn.className = "main-button disabled";
    }

    function crash() {
        clearInterval(timer);
        gameState = "crashed";
        multDisplay.style.color = "#ef4444";
        multDisplay.innerText = "BOOM!";
        rocket.style.display = "none";
        
        btn.innerText = "ВЗРЫВ!";
        btn.className = "main-button disabled";

        setTimeout(() => {
            // Сброс игры для нового раунда
            currentMult = 1.00;
            multDisplay.style.color = "#38bdf8";
            multDisplay.innerText = "x1.00";
            btn.className = "main-button bet-mode";
            btn.innerText = "СДЕЛАТЬ СТАВКУ";
            gameState = "waiting";
        }, 3000);
    }
</script>

</body>
</html>
